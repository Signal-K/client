---
id: y3n4kw
title: "2.2 native macos widget for survey pulse"
status: completed
priority: high
labels:
  - migration-2.2
  - macos
  - widget
  - analytics
specRefs:
  - "specs/migration/two-two-survey-audit-and-ops"
spec: "specs/migration/two-two-survey-audit-and-ops"
specPath: ".knowns/docs/specs/migration/two-two-survey-audit-and-ops.md"
createdAt: '2026-02-26T23:12:00Z'
updatedAt: '2026-02-27T11:35:00Z'
timeSpent: 0
---

# 2.2 native macos widget for survey pulse

## Description

Create a lightweight native macOS app and WidgetKit extension that display Star Sailors survey telemetry in a game-native format.

## Acceptance Criteria

- [x] #1 Native macOS app scaffold is created
- [x] #2 App shows shown/submitted/dismissed counts per survey
- [x] #3 App ships with bundled PostHog host/project/API key sourced from a local ignored xcconfig
- [x] #4 Build/run instructions are documented
- [x] #5 App includes a custom icon asset
- [x] #6 Widget extension registers in macOS (`pluginkit`)
- [x] #7 App shows recent answers and lightweight derived insights
- [x] #8 App sends a local macOS notification for each new successful completion
- [x] #9 App runs as a menu-bar accessory app without a Dock presence

## Implementation Notes

- Added native app scaffold under:
  - `apps/mac-widget/StarSailorsPulse/`
- Core files:
  - `project.yml` (xcodegen)
  - `Sources/App/StarSailorsPulseApp.swift`
  - `Sources/App/PulseViewModel.swift`
  - `Sources/App/PulseWidgetView.swift`
  - `Sources/App/PulseSettingsView.swift`
  - `Sources/Shared/PulseShared.swift`
  - `Sources/Widget/StarSailorsPulseWidget.swift`
  - `Config/App-Info.plist`
  - `Config/Widget-Info.plist`
  - `Config/StarSailorsPulse.entitlements`
  - `Config/StarSailorsPulseWidget.entitlements`
- Expanded the app from mechanic-only telemetry to:
  - PostHog surveys
  - mechanic micro-surveys
  - grouped views for both data sources
- Moved PostHog connection values into the signed app and widget bundles:
  - `STARSAILORS_POSTHOG_HOST`
  - `STARSAILORS_POSTHOG_PROJECT_ID`
  - `STARSAILORS_POSTHOG_PERSONAL_API_KEY`
- Moved the sensitive values out of tracked files and into a local ignored file:
  - `apps/mac-widget/StarSailorsPulse/Config/Secrets.xcconfig`
  - tracked template: `apps/mac-widget/StarSailorsPulse/Config/Secrets.xcconfig.example`
- Replaced the placeholder widget with a live desktop widget that fetches survey telemetry directly and renders top-survey activity.
- Expanded telemetry UI beyond counts:
  - recent successful completions with answer snippets
  - derived per-survey highlights from repeated answers
  - local notifications for newly observed successful completions
- Added app icon asset catalog under:
  - `Resources/Assets.xcassets/AppIcon.appiconset`
  - generated by `scripts/generate_icon.swift`
- Configured the host app as an accessory app:
  - `LSUIElement = true`
  - menu-bar panel remains the primary control surface
  - full console is opened from the menu bar via `Open Console`
- Generated project:
  - `StarSailorsPulse.xcodeproj` via `xcodegen generate`
- Added setup docs:
  - `apps/mac-widget/StarSailorsPulse/README.md`
- Installed a signed local build into:
  - `/Applications/StarSailorsPulse.app`

## Validation

- `xcodegen generate --spec apps/mac-widget/StarSailorsPulse/project.yml` passes.
- `xcodebuild -project StarSailorsPulse.xcodeproj -scheme StarSailorsPulse -configuration Debug -derivedDataPath build CODE_SIGNING_ALLOWED=NO` passes.
- Unsigned app bundle was re-signed with a valid local Apple Development identity and verifies successfully via `codesign --verify --deep --strict`.
- Installed app widget extension registers successfully:
  - `pluginkit -m -A -D | rg 'com\\.starsailors\\.pulse'`
  - result includes `com.starsailors.pulse.widget(0.1.0)`
